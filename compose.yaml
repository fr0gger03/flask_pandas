# Base Docker Compose Configuration
# Shared configuration for all environments
# Override with compose.override.yaml (local) or compose.production.yaml (production)

services:
  # Flask Application Service
  app:
    build:
      context: .
    environment:
      # Flask configuration
      - FLASK_ENV=${FLASK_ENV}
      - DATABASE_URL=${DATABASE_URL}
      - SECRET_KEY=${SECRET_KEY}
      - UPLOAD_FOLDER=${UPLOAD_FOLDER}
      # Security settings
      - WTF_CSRF_ENABLED=${WTF_CSRF_ENABLED}
      - WTF_CSRF_TIME_LIMIT=${WTF_CSRF_TIME_LIMIT}
      # File upload limits
      - MAX_CONTENT_LENGTH=${MAX_CONTENT_LENGTH}
    depends_on:
      db:
        condition: service_healthy

  # PostgreSQL Database Service
  db:
    image: postgres:17.4
    volumes:
      - ./parser/sql:/docker-entrypoint-initdb.d
    environment:
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      DB_APP_PASSWORD: ${DB_APP_PASSWORD}
    restart: always
    healthcheck:
      test: ["CMD", "pg_isready", "-U", "inventorydbuser", "-d", "inventorydb"]
      interval: 10s
      timeout: 5s
      retries: 5

